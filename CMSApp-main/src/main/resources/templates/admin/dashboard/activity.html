<!DOCTYPE html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AdminLTE 3 | Dashboard</title>

<th:block th:replace="~{fragments/header_link :: header_link}" />
<link rel="stylesheet"
	href="/admin/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet"
	href="/admin/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
<link rel="stylesheet"
	href="/admin/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">

<style>
button.show_list {
	border: 0;
	background-color: transparent;
	color: white;
	cursor: pointer;
}

button.show_list:hover {
	color: blue;
}
</style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">
	<div class="wrapper">

		<!-- Preloader -->
		<th:block th:replace="~{fragments/preloader :: preloader}" />

		<!-- Navbar -->
		<th:block th:replace="~{fragments/navi :: navi}" />
		<!-- /.navbar -->

		<!-- Main Sidebar Container -->
		<th:block th:replace="~{fragments/admin_sidebar :: admin_sidebar}" />

		<!-- /.sidebar -->

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<div class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1 class="m-0">나의 활동</h1>
						</div>
						<!-- /.col -->
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item"><a href="#">Home</a></li>
								<li class="breadcrumb-item active">Dashboard</li>
								<li class="breadcrumb-item active">나의 활동</li>
							</ol>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.container-fluid -->
			</div>
			<!-- /.content-header -->

			<!-- Main content -->
			<section class="content">
				<div class="container-fluid">
					<!-- Nav tabs -->
					<div class="row">
						<div class="col-md-12">
							<ul class="nav nav-tabs">
								<li class="nav-item"><a class="nav-link active"
									data-toggle="tab" href="#summary">요약 </a></li>
								<li class="nav-item"><a class="nav-link" data-toggle="tab"
									href="#entire-list">전체 보기</a></li>
							</ul>
						</div>
					</div>
					<!-- Nav Tabs End -->

					<!-- Tab panes -->
					<div class="tab-content mt-3">
					
						<!-- Tab -->
						<div class="tab-pane container-fluid active" id="summary">
						
							<!-- Row -->
							<div class="row">
								<div class="col-lg-4 col-12">
									<div id="box-waiting-review"
										class="small-box bg-success">
										<div class="inner">
											<h3>7</h3>
											<button id="btn-waiting-review"
												class="show_list">
												리뷰 대기 문서 <i class="fas fa-arrow-circle-right"></i>
											</button>
										</div>
									</div>
								</div>

								<div class="col-lg-4 col-12">
									<div id="box-complete-review"
										class="small-box bg-info">
										<div class="inner">
											<h3>35</h3>
											<button id="btn-complete-review"
												class="show_list">
												리뷰 완료 문서 <i class="fas fa-arrow-circle-right"></i>
											</button>
										</div>
									</div>
								</div>

								<div class="col-lg-4 col-12">
									<div id="box-rejected" class="small-box bg-danger">
										<div class="inner">
											<h3>35</h3>
											<button id="btn-rejected" class="show_list">
												반려 문서 <i class="fas fa-arrow-circle-right"></i>
											</button>
										</div>
									</div>
								</div>

							</div>
							<!-- Row end -->

							<!-- Row -->
							<div class="row">
								<div class="col-lg-12">
									<!-- Card -->
									<div class="card mt-3">
										<div class="card-header border-transparent">
											<h3 class="card-title">목록</h3>

										</div>
										<div class="card-body p-0">
											<div class="table-responsive">
												<table id="table-preview" class="table table-hover m-0">
													<thead>
														<tr>
															<th>No.</th>
															<th>제목</th>
															<th>버전</th>
															<th>사원</th>
															<th>결재 상태</th>
															<th>코멘트</th>
															<th>일자</th>
														</tr>
													</thead>
													<tbody>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<!-- Card End -->
								</div>
								<!-- Col End -->
							</div>
							<!-- Row End -->

						</div>
						<!-- Tab End -->

						<!-- Tab -->
						<div class="tab-pane container-fluid fade" id="entire-list">
							<!-- Row -->
							<div class="row">
								<div class="col-md-12">

									<!-- Card -->
									<div class="card">
										<div class="card-header">
											<h3 class="card-title">필터</h3>
											<div class="card-tools">
												<button id="btn-filtered"
													class="btn btn-primary">조회하기</button>
											</div>
										</div>
										
										<div class="card-body">

											<div class="row">
												<div class="col-sm-3">날짜</div>
												<div class="col-sm-3">
													<div class="icheck-primary d-inline">
															<input type="radio" id="radio-date-all" name="date-filter"
																checked=""> <label for="radio-date-all">전체 보기 </label>
													</div>
												</div>
												<div class="col-sm-6">
												<div class="icheck-primary d-inline">
														<input type="radio" id="radio-date-custom" name="date-filter"
																checked=""> <label for="radio-date-custom">날짜 선택 </label>
														</div>
														<!-- input-group -->
														<div class="input-group">
															<!-- button -->
															<button type="button" class="btn btn-default float-right"
																id="daterange-btn">
																<i class="far fa-calendar-alt"></i> <span></span>
																<i class="fas fa-caret-down"></i>
															</button>
														</div>
													</div>
											</div>

											<!-- <div class="row">
												<div class="col-sm-3">사원</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-emp-all" name="emp-filter"
																checked=""> <label for="radio-emp-all">전체 보기 </label>
														</div>
												</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-emp-me" name="emp-filter" value=""
																checked=""> 
																<label for="radio-emp-me">나의
																활동만 보기 </label>
														</div>
												</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-emp-dept" name="emp-filter" value=""
																checked=""> <label for="radio-emp-dept">나의
																부서 활동 전체 보기 </label>
														</div>
												</div>
											</div> -->

											<div class="row">
												<div class="col-sm-3">결재 상태</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-status-all"
																name="status-filter" value="" checked=""> 
																<label
																for="radio-status-all">전체 보기 </label>
														</div>
												</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-status-waiting"
																name="status-filter" value="200" checked=""> <label
																for="radio-status-waiting">리뷰 대기 문서 </label>
														</div>
												</div>
												<div class="col-sm-3">
														<div class="icheck-primary d-inline">
															<input type="radio" id="radio-status-complete"
																name="status-filter" value="300" checked=""> <label
																for="radio-status-complete">리뷰 완료 문서 </label>
														</div>
												</div>
											</div>

										</div>
										<!-- card-body end -->
									</div>
									<!-- Card End -->
									
									<!-- trable wrapper -->
											<div id="publish-table_wrapper"
												class="dataTables_wrapper dt-bootstrap4">

												<div class="row">
													<div class="col-sm-12">
														<table id="table-filtered"
															class="bg-white table table-hover table-bordered dataTable dtr-inline">
															<thead>
																<tr>
																	<th>선택</th>
																	<th>No.</th>
																	<th>제목</th>
																	<th>버전</th>
																	<th>검토자</th>
																	<th>요청자</th>
																	<th>결재 상태</th>
																	<th>코멘트</th>
																	<th>배포일자</th>

																</tr>
															</thead>
															<tbody>
																
															</tbody>
														</table>
													</div>
												</div>
											</div>
											<!-- table wrapper end -->

								</div>
								<!-- col end -->
							</div>
							<!-- Row End -->

							<!-- <div class="row">
								<div class="col-md-12">
									<div class="card">
										<div class="card-header">시각화 보드</div>
										<div class="card-body">
											<div class="row">
												<div class="col-md-6">
													<div class="card card-row card-secondary">
														<div class="card-header">
															<h3 class="card-title">배포 대기</h3>
														</div>
														<div class="card-body">

															<div class="card card-light card-outline">
																<div class="card-header">
																	<h5 class="card-title">캐릭터 소개 (1)</h5>
																	<div class="card-tools">
																		<a href="#" class="btn btn-tool btn-link">#7</a> <a
																			href="#" class="btn btn-tool"> <i
																			class="fas fa-pen"></i>
																		</a>
																	</div>
																</div>
															</div>
														</div>
													</div>
													card end
												</div>

												<div class="col-md-6">
													<div class="card card-row card-info">
														<div class="card-header">
															<h3 class="card-title">배포 완료</h3>
														</div>
														<div class="card-body">

															<div class="card card-light card-outline">
																<div class="card-header">
																	<h5 class="card-title">오류 해결 (1)</h5>
																	<div class="card-tools">
																		<a href="#" class="btn btn-tool btn-link">#7</a> <a
																			href="#" class="btn btn-tool"> <i
																			class="fas fa-pen"></i>
																		</a>
																	</div>
																</div>
															</div>
														</div>
													</div>
													card end
												</div>

											</div>

										</div>

									</div>

								</div>
							</div> -->



						</div>
						<!-- Tab End -->

					</div>
					<!-- Tab panes End -->
				</div>
				<!-- /.container-fluid -->
			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		<th:block th:replace="~{fragments/footer :: footer}" />

		<!-- Control Sidebar -->
		<aside class="control-sidebar control-sidebar-dark">
			<!-- Control sidebar content goes here -->
		</aside>
		<!-- /.control-sidebar -->
	</div>
	<!-- ./wrapper -->

	<th:block th:replace="~{fragments/footer_link :: footer_link}" />

	<!-- data-table js 파일 -->
	<script src="/admin/plugins/datatables/jquery.dataTables.min.js"></script>
	<script
		src="/admin/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
	<script
		src="/admin/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
	<script
		src="/admin/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
	<script
		src="/admin/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
	<script
		src="/admin/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
	<script src="/admin/plugins/jszip/jszip.min.js"></script>
	<script src="/admin/plugins/pdfmake/pdfmake.min.js"></script>
	<script src="/admin/plugins/pdfmake/vfs_fonts.js"></script>
	<script src="/admin/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
	<script src="/admin/plugins/datatables-buttons/js/buttons.print.min.js"></script>
	<script
		src="/admin/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
	<script>
		
		// 요약 탭 -> 결재 상태에 따라 문서 목록 데이터 가져오기
		function getSummaryData(status_code) {
			$.ajax({
				type:"GET",  //전송타입
				url:"/dashboard/summary/list?status_code=" + status_code,
				success: function (result, status, xhr) {
					
					alert('문서 불러오기 성공');
					
					let preview = $("#table-preview tbody");
					preview.empty(); // 테이블 초기화
					
					let tr = "";
					
					if (result.length == 0) {
						tr += "<tr><td colspan='6'>내용이 없습니다.</td></tr>";
					}
					
					// 배지 색 정하기
					let statusBadge = null;
					
					if (status_code == 200) {
						statusBadge = "badge-success";
					} else if (status_code == 300) {
						statusBadge = "badge-info";
					} else if (status_code == 500) {
						statusBadge = "badge-danger";
					}
					
					// 차후 10건까지만 보여주는 것으로 변경
					for (let i = 0; i < result.length; i++) {
						
						tr += `
							<tr>
							<td>${i+1}</td>
							<td><a href="#">${result[i].title}</a></td>
							<td>${result[i].version}</td>
							<td>${result[i].emp_name}<br>${result[i].dept_name}</td>
							<td><span class="badge ${statusBadge}">${result[i].status_name}</span></td>
							<td>${result[i].comments}
							</td>
							<td>${result[i].regdate}</td>
						</tr>
						`;
					}
					preview.html(tr);
					
				},
				error: function (xhr, status, e) {
					console.log("error", e);
					console.log("status", status);
				}
			});
		}
		
		// 전체 보기 탭 -> 필터에 따라 문서 목록 가져오기
		function getFilteredData(status_code, startDate, endDate, emp_idx, dept_idx, project_idx) {
			$.ajax({
				type:"GET",  //전송타입
				url:"/dashboard/entire/list?status_code=" + status_code 
						+ "&startDate=" + startDate + "&endDate=" + endDate 
						+ "&emp_idx=" + emp_idx + "&dept_idx=" + dept_idx
						+ "&project_idx=" + project_idx,
						
				success: function (result, status, xhr) {
					
					alert('문서 불러오기 성공');
					
					// 데이터 테이블 적용
/* 					$("#table-filtered").DataTable({
						ordering: true,
						serverSide: false,
						ajax: JSON.stringify(result)
					}); */
					
					let preview = $("#table-filtered tbody");
					preview.empty(); // 테이블 초기화
					
					let tr = "";
					
					if (result.length == 0) {
						tr += "<tr><td colspan='6'>내용이 없습니다.</td></tr>";
					}
					
					// 차후 10건까지만 보여주는 것으로 변경
					for (let i = 0; i < result.length; i++) {
						
						// 배지 색 정하기
						let statusBadge = null;
						
						if (status_code == 200) {
							statusBadge = "badge-success";
						} else if (status_code == 300) {
							statusBadge = "badge-info";
						} else if (status_code == 500) {
							statusBadge = "badge-danger";
						}
						
						tr += `
							<tr>
							<td>${i+1}</td>
							<td><a href="#">${result[i].title}</a></td>
							<td>${result[i].version}</td>
							<td>${result[i].emp_name}<br>${result[i].dept_name}</td>
							<td><span class="badge ${statusBadge}">${result[i].status_name}</span></td>
							<td>${result[i].comments}
							</td>
							<td>${result[i].regdate}</td>
						</tr>
						`;
					}
					preview.html(tr);
					
				},
				error: function (xhr, status, e) {
					console.log("error", e);
					console.log("status", status);
				}
			});
			
		}
	
	
		$(function() {
			
			/*******************************
				*[요약 탭] 
			********************************/
			
			// 목록 초기화
			let preview = $("#table-preview tbody");
			tr = "<tr><td colspan='6'>위에서 버튼을 클릭해 주세요.</td></tr>";
			preview.html(tr);
			
			// 리뷰 대기 문서 미리보기
			$('#btn-waiting-review').click(function(){
				getSummaryData(200);
			});
			
			// 리뷰 완료 문서 미리보기
 			$('#btn-complete-review').click(function(){
				getSummaryData(300);
			});
			
			// 반려 문서 미리보기
 			$('#btn-rejected').click(function(){
				getSummaryData(500);
			});
			
			/*******************************
				*[전체보기 탭]
			********************************/

			//날짜 선택: 디폴트로 "전체" 표시
			$('#daterange-btn span').html("전체");
			
			let filter_startDate = "";
			let filter_endDate = "";		

			// 날짜 선택
			$('#daterange-btn').daterangepicker({
								// 초기화
								filter_startDate : null,
								filter_endDate : moment(),
			
								// 라벨 설정
								ranges : {
									'전체' : [null, moment()],
									'오늘' : [ moment(), moment() ],
									'어제' : [ moment().subtract(1, 'days'),
											moment().subtract(1, 'days') ],
									'지난 7일' : [ moment().subtract(6, 'days'),
											moment() ],
									'지난 30일' : [ moment().subtract(29, 'days'),
											moment() ]
								},

								// [취소], [적용] 버튼 없음
								autoApply : true
							},
							function(start, end) {
								
								alert(start);
							
								filter_startDate = start.format("YYYY-MM-DD hh:mm:ss");
								filter_endDate = end.format("YYYY-MM-DD hh:mm:ss");
								
								if (this.chosenLabel == "전체") {
									$('#daterange-btn span').html("전체");
								} else if (this.chosenLabel == "오늘") {
									$('#daterange-btn span').html("오늘");
								} else if (this.chosenLabel == "어제") {
									$('#daterange-btn span').html("어제");
								} else {
									$('#daterange-btn span').html(start.format('YYYY/MM/DD') + ' - ' + end.format('YYYY/MM/DD'));
								}
							});
			
			
			// 필터링된 목록 가져오기
			// status_code, startDate, endDate, emp_idx, dept_idx, project_idx
			$('#btn-filtered').click(function(){
				let filter_statusCode = document.querySelector("input[name='status-filter']:checked").value;
				
				getFilteredData(filter_statusCode, filter_startDate, filter_endDate, 0, 0, 0);
			});
			

							
		});
	</script>

</body>

</html>
