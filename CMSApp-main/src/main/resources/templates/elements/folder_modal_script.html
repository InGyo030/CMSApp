<th:block th:fragment="folder_modal_script">
	<script>
		let jsonData;
		let jsTreeData;
		function getFolderJson() {
			$.ajax({
				method: "GET",
				url: "/document/folder/list",
				contentType: "application/json",
				success: function (result, status, xhr) {
					jsonData = JSON.stringify(result);
					jsTreeData = jsonData.map(convertToJsTree);
					console.log(jsTreeData);
				},
				error: function (status, xhr, err) {
					alert("폴더트리구조를 로드하는데 실패했습니다");
				}
			});
		}

		function convertToJsTree(folderDTO) {
			return {
				id: folderDTO.folder_idx,
				text: folderDTO.folder_name,
				icon: "fa fa-folder",
				children: folderDTO.childFolderList.map(convertToJsTree),
				data: {
					project: folderDTO.project,
					regdate: folderDTO.regdate,
					parent_folder: folderDTO.parent_folder
				}
			};
		}

		
		// 파일탐색기(모달) 관련
		$(document).ready(function () {
			initializeModal();
			initializeDirectoryTree();
		});

		function initializeModal() {
			$('#directoryModal').on('shown.bs.modal', function () {
				initializeDirectoryTree();
			});
		}

		// data 안에 배열로 자식구조를 구현합니다(jsTree)
		function initializeDirectoryTree() {
			getFolderJson();
			$('#jstree_demo_div').jstree({
				'core': {
					'data': jsTreeData
				}
			});

			$('#jstree_demo_div').on('changed.jstree', function (e, data) {
				if (data.selected.length > 0) {
					updateBreadcrumb(data.instance.get_path(data.selected[0]));
				}
			});
		}

		function updateBreadcrumb(path) {
			const breadcrumb = $('#breadcrumb');
			breadcrumb.empty();
			path.forEach((segment, index) => {
				if (index === path.length - 1) {
					breadcrumb.append(`<li class="breadcrumb-item active" aria-current="page">${segment}</li>`);
				} else {
					breadcrumb.append(`<li class="breadcrumb-item">${segment}</li>`);
				}
			});
		}

		function selectDirectory() {

			var selectedNode = $('#jstree_demo_div').jstree("get_selected", true);
			if (selectedNode.length > 0) {
				var selectedPath = $('#jstree_demo_div').jstree().get_path(selectedNode[0], '/');
				console.log('Selected Directory:', selectedPath);
			} else {
				console.log('No directory selected.');
			}
			$('#directoryModal').modal('hide');
		}
		// 파일탐색기 관련 end
	</script>
</th:block>